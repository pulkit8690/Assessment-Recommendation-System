import streamlit as st
import pandas as pd
from main import recommend

# Set page config
st.set_page_config(
    page_title="SHL Assessment Recommendation Engine",
    page_icon="üìã",
    layout="centered",
    initial_sidebar_state="auto"
)

# Dark mode toggle is handled by Streamlit theme settings
st.markdown("""
    <style>
        .block-container {
            padding-top: 2rem;
        }
        .css-1aumxhk { max-width: 1000px; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
""", unsafe_allow_html=True)

# Header with icon
st.markdown(
    """
    <div style="display: flex; align-items: center; gap: 1rem;">
        <img src="https://raw.githubusercontent.com/pulkitarora-py/Assessment-Recommendation-System/main/static/favicon.png" width="40" height="40" style="border-radius: 8px;" />
        <h1 style="margin: 0;">SHL Assessment Recommendation Engine</h1>
    </div>
    """,
    unsafe_allow_html=True
)

# Form for query input
with st.form("recommendation_form"):
    query = st.text_area("Enter your hiring query:", height=150)
    model = st.selectbox("Select AI Model:", ["gemini", "together"])
    submitted = st.form_submit_button("Find Matching Assessments")

# Display results
if submitted and query.strip():
    with st.spinner("Finding matching assessments..."):
        try:
            results_df = recommend(query, engine=model)
            if not results_df.empty:
                # Display only key columns
                table_df = results_df[["assessment_name", "duration", "remote", "test_type", "relative_url"]].copy()
                table_df.rename(columns={
                    "assessment_name": "Assessment Name",
                    "duration": "Duration",
                    "remote": "Remote",
                    "test_type": "Test Type",
                    "relative_url": "URL"
                }, inplace=True)

                # Make URL clickable
                table_df["URL"] = table_df["URL"].apply(lambda url: f"[Link]({url})" if pd.notna(url) and url != "nan" else "‚Äî")

                st.markdown("### Recommended Assessments")
                st.write(table_df.to_markdown(index=False), unsafe_allow_html=True)
            else:
                st.info("No matching assessments found. Try refining your query or model.")
        except Exception as e:
            st.error(f"An error occurred: {e}")

# Footer
st.markdown("""
---
Made by [Pulkit Arora](https://www.linkedin.com/in/pulkit-arora-731b17227/) ‚Ä¢ Built with ‚ù§Ô∏è using Streamlit and AI APIs
""")